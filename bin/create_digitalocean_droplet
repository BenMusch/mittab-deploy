#!/bin/bash

set -e

IMAGE_NAME=$1-$(date +%s)

if [ -d "mit-tab"  ]; then
  echo "mit-tab already dowloaded, no need to clone"
else
  git clone $GITHUB_CLONE_URL
fi

cd mit-tab

docker-machine create \
  -d digitalocean \
  --digitalocean-access-token=$DIGITALOCEAN_TOKEN \
  --engine-install-url=https://releases.rancher.com/install-docker/17.05.sh \
  $IMAGE_NAME

eval $(docker-machine env --shell sh $IMAGE_NAME)

echo 'BUILD WEB...'

docker-compose build --build-arg password=$2 web

echo 'BUILD NGINX...'

docker-compose build nginx

echo 'DC UP...'

docker-compose up -d
