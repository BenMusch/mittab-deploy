#!/bin/bash

ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@$1 <<EOL
  apt-get install -y --fix-missing python-pip;
  pip install docker-compose;
  cd /usr/src;
  git clone -b $3 $2;
  cd mit-tab;
  docker-compose up -d;
  docker-compose run -d --rm web python manage.py migrate;
  docker-compose run -d --rm web python manage.py collectstatic --noinput;
  docker-compose run -d --rm web python manage.py initialize_tourney --tab-password $3 backups .;
  docker-compose restart web;
  docker-compose restart nginx
EOL
