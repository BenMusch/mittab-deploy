{% extends "base.html" %}

{% block content %}
  <center>
    <h1>Create a Tournament</h1>
  </center>
  <br>

<script src="https://checkout.stripe.com/checkout.js"></script>
<script>
var handler = StripeCheckout.configure({
  key: "{{stripe_key}}",
  locale: 'auto',
  token: function(token) {
    document.tournament.stripe_token.value = token.id
    document.tournament.submit()
  }
});

function handleSubmit() {
  if (!document.tournament.stripe_token.value) {
    handler.open({
      name: 'MIT-Tab',
      description: 'MIT-Tab server',
      email: document.tournament.email.value,
      amount: {{ stripe_cost }}
    });
  }
  return !!document.tournament.stripe_token.value;
}

// Close Checkout on page navigation:
window.addEventListener('popstate', function() {
  handler.close();
});
</script>

  <form action="/tournaments/new"
    method="post"
    id="form"
    onsubmit="return handleSubmit()"
    name="tournament">
    {{ form.hidden_tag() }}

    <div class="form-group">
      {{ form.name.label }}
      <span class="help-block">
        This will be the subdomain for the tournament (e.g.
        example.nu-tab.com). Cannot include spaces or special characters.
      </span>
      {% for error in form.name.errors %}
        <span class="text-danger">[{{error}}]</span>
      {% endfor %}<br>
      {{ form.name(class='form-control') }}
    </div>

    <div class="form-group">
      {{ form.email.label }}
      <span class="help-block">
        You will receive an email with info about running the tournament.
      </span>
      {% for error in form.email.errors %}
        <span class="text-danger">[{{error}}]</span>
      {% endfor %}<br>
      {{ form.email(class='form-control', id='email') }}
    </div>

    <div class="form-group">
      {{ form.password.label }}
      <span class="help-block">
        You should choose a password you're comfortable sharing with tab staff
        members. Avoid something you use for other web sites.
      </span>
      {% for error in form.password.errors %}
        <span class="text-danger">[{{error}}]</span>
      {% endfor %}<br>
      {{ form.password(class='form-control') }}
    </div>

    <div class="form-group">
      {{ form.confirm.label }}
      {% for error in form.confirm.errors %}
        <span class="text-danger">[{{error}}]</span>
      {% endfor %}<br>
      {{ form.confirm(class='form-control') }}
    </div>

    <div class="form-group">
      {{ form.add_test.label }}: {{ form.add_test }}
      <span class="help-block">
        This will spin up a smaller tournament at
        [tournament_name]-test.nu-tab.com pre-loaded with test data. If you've
        never run a tournament with mit-tab, this is a good way to learn the
        software. Note: The login for the tab user will always be 'password'
      </span>
      {% for error in form.add_test.errors %}
        <span class="text-danger">[{{error}}]</span>
      {% endfor %}<br>
    </div>

    <div class="form-group">
      {{ form.repo_options.label }}
      {% for error in form.repo_options.errors %}
        <span class="text-danger">[{{error}}]</span>
      {% endfor %}<br>
      {{ form.repo_options(class='form-control') }}
    </div>

    <input type="submit"
           value="Create & Pay ${{stripe_cost // 100}}"
           class="btn btn-primary" />

  </form>
{% endblock %}
